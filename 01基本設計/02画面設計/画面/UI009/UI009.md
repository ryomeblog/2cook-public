# UI009 - 料理一覧画面

---

## 画面イメージ
![画面イメージ](./画面イメージ.drawio.svg)

---

## 画面詳細

**基本情報**

| 画面ID | 論理画面名   | 物理画面名   | BaseURL    |
| ------ | ------------ | ------------ | ---------- |
| UI009  | 料理一覧画面 | cook_list.js | /cook_list |

**画面情報**

| No  | 画面項目名                                             | フィールドタイプ         | 入力規制       | 必須 | 文字数 | 初期値 | イベント | 備考                                                     |
| --- | ------------------------------------------------------ | ------------------------ | -------------- | ---- | ------ | ------ | -------- | -------------------------------------------------------- |
| ①   | 画面タイトル                                           | ラベル                   | -              | -    | -      | -      | -        |                                                          |
| ②   | 料理名                                                 | ラベル                   | -              | -    | -      | -      | -        |                                                          |
| ③   | 料理名入力フォーム、検索ボタン                         | テキストボックス, ボタン | 半角英数字のみ | ○    | 200    | -      | EVT-001  | テキストボックスとボタンをセットで表示する。             |
| ④   | 料理登録ボタン                                         | ボタン                   | -              | -    | -      | -      | EVT-002  |                                                          |
| ⑤   | 食材選択ボタン                                         | ボタン                   | -              | -    | -      | -      | EVT-003  |                                                          |
| ⑥   | 自分のレシピのみチェックボックス                       | チェックボックス         | -              | -    | -      | -      | EVT-004  |                                                          |
| ⑦   | 料理カード                                             | カード                   | -              | -    | -      | -      | -        |                                                          |
| ⑧   | 料理詳細表示ボタン                                     | ボタン                   | -              | -    | -      | -      | EVT-005  |                                                          |
| ⑨   | 料理共有・共有解除・追加ボタン                         | ボタン                   | -              | -    | -      | -      | EVT-006  | 状態によって表示を切り替える。                           |
| ⑩   | 食材チェックボックス                                   | チェックボックス         | -              | -    | -      | -      | -        | 常時非活性で、検索に引っかかる場合のみチェックをつける。 |
| ⑪   | あとこれがあれば作れるレシピ                           | ラベル                   | -              | -    | -      | -      | -        |                                                          |
| ⑫   | 追加料理カード                                         | カード                   | -              | -    | -      | -      | -        |                                                          |
| ⑬   | 追加料理詳細表示ボタン                                 | ボタン                   | -              | -    | -      | -      | EVT-007  |                                                          |
| ⑭   | 追加料理共有・共有解除・追加ボタン                     | ボタン                   | -              | -    | -      | -      | EVT-008  | 状態によって表示を切り替える。                           |
| ⑮   | モーダルウィンドウタイトル                             | ラベル                   | -              | -    | -      | -      | -        |                                                          |
| ⑯   | 食材選択モーダルウィンドウ                             | モーダルウィンドウ       | -              | -    | -      | -      | -        |                                                          |
| ⑰   | 食材選択ラベル                                         | ラベル                   | -              | -    | -      | -      | -        |                                                          |
| ⑱   | 食材選択カード                                         | カード                   | -              | -    | -      | -      | -        |                                                          |
| ⑲   | 食材選択チェックボックス・テキストボックス・単位ラベル | チェックボックス         | -              | -    | -      | -      | -        |                                                          |
| ⑳   | 食材選択決定ボタン                                     | ボタン                   | -              | -    | -      | -      | EVT-009  |                                                          |
| ㉑  | 食材選択クリアボタン                                   | ボタン                   | -              | -    | -      | -      | EVT-010  |                                                          |

---

## 処理詳細

- **EVT-000 初期表示**
    1. `$料理カード作成` を呼び出す。
        - 引数なし
    2. 画面表示を行う。

<br>

- **EVT-001 料理名検索ボタン押下**
    1. `$料理カード作成` を呼び出す。
        - 以下の引数を渡す。

            | 変数名                 | 値                                      |
            | ---------------------- | --------------------------------------- |
            | 料理名                 | ***③料理名入力フォーム***               |
            | 自分のレシピのみフラグ | ***⑥自分のレシピのみチェックボックス*** |
            | 食材リスト             | `@食材チェックリスト`                   |

<br>

- **EVT-002 料理登録ボタン押下**
    1. `UI010 - 料理登録画面` に遷移する。

<br>

- **EVT-003 食材選択ボタン押下**
    1. ***⑮モーダルウィンドウタイトル*** を表示する。
    2. `API018 - 食材検索機能` にリクエストを送る。
        - リクエストは以下の通り
            - メソッド：GET
            - リクエストURL：`/food`
            - リクエストヘッダー：
                
                | リクエストヘッダー名 | 値               |
                | -------------------- | ---------------- |
                | Content-Type         | application/json |
                | JSESSION             | ログイン時に取得 |

            - リクエストボディ：なし

        - レスポンスがエラーの場合、`共通画面：エラー画面` に遷移し、[エラーメッセージID](../../画面エラーメッセージ一覧表.md) `E-101` を表示し、処理を終了する。
    3. 2のレスポンスから `＠食材リスト` を作成する。
        - 以下のように `＠食材リスト` にレスポンスを格納する。

            | 食材リスト要素 | 型     | 値                     |
            | -------------- | ------ | ---------------------- |
            | 食材ID         | 文字列 | レスポンスの料理ID     |
            | 食材名         | 文字列 | レスポンスの料理名     |
            | 単位           | 文字列 | レスポンスの手順       |
            | その他1        | 文字列 | レスポンスのその他1    |
            | その他2        | 文字列 | レスポンスのその他2    |
            | その他3        | 文字列 | レスポンスのその他3    |
            | その他4        | 文字列 | レスポンスのその他4    |
            | その他5        | 文字列 | レスポンスのその他5    |
            | バージョン     | 文字列 | レスポンスのバージョン |
    4. `＠食材リスト` の要素数分 ***⑱食材選択カード*** を作成する。
        - 食材は以下の処理で表示を決める。
            1. `＠食材リスト`の要素数分食材を表示する。
                - 表示は ***⑲食材選択チェックボックス*** 、`＠食材リスト`の食材名、***⑲食材選択テキストボックス***、`＠食材リスト`の単位とする。
    5. 画面に更新を行う。

<br>

- **EVT-004 自分のレシピのみチェックボックス押下**
    1. `$料理カード作成` を呼び出す。
        - 以下の引数を渡す。

            | 変数名                 | 値                                      |
            | ---------------------- | --------------------------------------- |
            | 料理名                 | ***③料理名入力フォーム***               |
            | 自分のレシピのみフラグ | ***⑥自分のレシピのみチェックボックス*** |
            | 食材リスト             | `@食材チェックリスト`                   |

<br>

- **EVT-005 料理詳細表示ボタン押下**
    1. 以下のパラメータを取得する。

        | 変数名 | 型     |
        | ------ | ------ |
        | 料理ID | 文字列 |

    2. `UI011 - 料理詳細画面` に遷移する。
        - `＠料理ID` をパスパラメータに指定する。

<br>

- **EVT-006 料理共有・共有解除・追加ボタン押下**
    1. 以下のパラメータを取得する。

        | 変数名           | 型     |
        | ---------------- | ------ |
        | 料理ID           | 文字列 |
        | レシピ所有フラグ | 真偽値 |

    2. `＠レシピ所有フラグ` が `False` の場合、処理を終了し、`UI013 - 料理複製画面` に遷移する。
        - `＠料理ID` をパスパラメータに指定する。
        - `＠レシピ所有フラグ` が `True` の場合、次の処理へ。
    3. `API013 - 料理編集機能` にリクエストを送る。
        - リクエストは以下の通り
            - メソッド：PUT
            - リクエストURL：`/cook`
            - リクエストヘッダー：
                
                | リクエストヘッダー名 | 値               |
                | -------------------- | ---------------- |
                | Content-Type         | application/json |
                | JSESSION             | ログイン時に取得 |

            - リクエストボディ：
                
                | リクエスト名 | 値                                |
                | ------------ | --------------------------------- |
                | 料理ID       | `＠料理ID` |
                | 共有フラグ   | `＠料理リスト` の共有フラグの否定 |

        - レスポンスがエラーの場合、`共通画面：エラー画面` に遷移し、[エラーメッセージID](../../画面エラーメッセージ一覧表.md) `E-101` を表示し、処理を終了する。
    4. 画面の更新を行う。

<br>

- **EVT-007 追加料理詳細表示ボタン押下**
    1. 以下のパラメータを取得する。

        | 変数名 | 型     |
        | ------ | ------ |
        | 料理ID | 文字列 |

    2. `UI011 - 料理詳細画面` に遷移する。
        - `＠料理ID` をパスパラメータに指定する。

<br>

- **EVT-008 追加料理共有・共有解除・追加ボタン押下**
    1. 以下のパラメータを取得する。

        | 変数名           | 型     |
        | ---------------- | ------ |
        | 料理ID           | 文字列 |
        | レシピ所有フラグ | 真偽値 |

    2. `＠レシピ所有フラグ` が `False` の場合、処理を終了し、`UI013 - 料理複製画面` に遷移する。
        - `＠料理ID` をパスパラメータに指定する。
        - `＠レシピ所有フラグ` が `True` の場合、次の処理へ。
    3. `API013 - 料理編集機能` にリクエストを送る。
        - リクエストは以下の通り
            - メソッド：PUT
            - リクエストURL：`/cook`
            - リクエストヘッダー：
                
                | リクエストヘッダー名 | 値               |
                | -------------------- | ---------------- |
                | Content-Type         | application/json |
                | JSESSION             | ログイン時に取得 |

            - リクエストボディ：
                
                | リクエスト名 | 値                                |
                | ------------ | --------------------------------- |
                | 料理ID       | `＠料理リスト` の共有フラグの否定 |
                | 共有フラグ   | `＠料理リスト` の共有フラグの否定 |

        - レスポンスがエラーの場合、`共通画面：エラー画面` に遷移し、[エラーメッセージID](../../画面エラーメッセージ一覧表.md) `E-101` を表示し、処理を終了する。
    4. 画面の更新を行う。

<br>

- **EVT-009 食材選択決定ボタン押下**
    1. ***⑲食材選択チェックボックス*** にチェックが入った要素全てを `@食材チェックリスト` に格納する。

            | 食材チェックリスト要素 | 型     | 値                              |
            | ---------------------- | ------ | ------------------------------- |
            | 食材ID                 | 文字列 | レスポンスの料理ID              |
            | 食材名                 | 文字列 | ***⑲食材選択チェックボックス*** |
            | 単位値                 | 数値   | ***⑲食材選択テキストボックス*** |

    2. `$料理カード作成` を呼び出す。
        - 以下の引数を渡す。

            | 変数名                 | 値                                      |
            | ---------------------- | --------------------------------------- |
            | 料理名                 | ***③料理名入力フォーム***               |
            | 自分のレシピのみフラグ | ***⑥自分のレシピのみチェックボックス*** |
            | 食材リスト             | `@食材チェックリスト`                   |
    3. ***⑮モーダルウィンドウタイトル*** を閉じる。

<br>

- **EVT-010 食材選択クリアボタン押下**
    1. ***⑲食材選択チェックボックス*** にチェックが入った要素全てのチェックを外す。

<br>

- **FUNC-001 料理カード作成**
    1. ***⑦料理カード*** を全て削除する。
    2. 以下の引数を受け取る。

        | 変数名                 | 型     |
        | ---------------------- | ------ |
        | 料理名                 | 文字列 |
        | 自分のレシピのみフラグ | 真偽値 |
        | 食材リスト             | 配列   |
        | - 食材ID               | 文字列 |
        | - 単位値               | 数値   |
        | ソート項目             | 数値   |
        | 昇順／降順             | 数値   |
        | オフセット             | 数値   |

    3. バリデーションチェックを行う。
        - バリデーションチェックは以下の通り

        | 変数名素           | 必須 | 最小文字数 | 最大文字数 | パターン | その他 |
        | ------------------ | ---- | ---------- | ---------- | -------- | ------ |
        | 料理名             | ○    | 1          | 200        | -        | -      |
        | 食材リストの食材ID | ○    | 12         | 12         | -        | -      |
        | 食材リストの単位値 | ○    | 1          | -          | -        | -      |

    4. `API010 - 料理検索機能` にリクエストを送る。
        - リクエストは以下の通り
            - メソッド：GET
            - リクエストURL：`/cook`
            - リクエストヘッダー：
                
                | リクエストヘッダー名 | 値               |
                | -------------------- | ---------------- |
                | Content-Type         | application/json |
                | JSESSION             | ログイン時に取得 |

            - リクエストボディ：
                
                | リクエスト名 | 値                        |
                | ------------ | ------------------------- |
                | 料理名       | `@料理名`                 |
                | レシピフラグ | `@自分のレシピのみフラグ` |
                | 食材リスト   | `@食材リスト`             |
                | ソート項目   | `@ソート項目`             |
                | 昇順／降順   | `@昇順／降順`             |
                | 最大取得数   | 20                        |
                | オフセット   | `@オフセット`             |

                ※ 各値がNULLの場合、リクエストには含まない。

        - レスポンスがエラーの場合、`共通画面：エラー画面` に遷移し、[エラーメッセージID](../../画面エラーメッセージ一覧表.md) `E-101` を表示し、処理を終了する。
    5. 4のレスポンスから `＠料理リスト` を作成する。
        - 以下のように `＠料理リスト` にレスポンスを格納する。

            | 料理リスト要素   | 型     | 値                     |
            | ---------------- | ------ | ---------------------- |
            | 料理ID           | 文字列 | レスポンスの料理ID     |
            | 料理名           | 文字列 | レスポンスの料理名     |
            | 手順             | 文字列 | レスポンスの手順       |
            | 金額             | 数値   | レスポンスの金額       |
            | 共有フラグ       | 真偽値 | レスポンスの共有フラグ |
            | レシピ所有フラグ | 真偽値 | レスポンスの食材リスト |
            | 食材リスト       | 配列   | レスポンスの食材リスト |
            | バージョン       | 文字列 | レスポンスのバージョン |

    6. `＠料理リスト` の要素数分 ***⑦料理カード*** を作成する。
        - `＠料理リスト` の要素数が20件を超える場合は上から20件のみ表示する。
        - タイトルには `＠料理リスト` の料理名を表示する。
        - ***⑨料理共有・共有解除・追加ボタン*** は以下の処理で表示を決める。
            1. `＠料理リスト` のレシピ所有フラグが `False` の場合、`追加ボタン` を表示する。
                - `＠料理リスト` のレシピ所有フラグが `True` の場合、次の処理を行う。
                - `＠料理リスト` のレシピ所有フラグが `False` の場合、処理を終了する。
            2. `＠料理リスト` の共有フラグが `True` の場合、`共有解除ボタン` を表示する。
            3. `＠料理リスト` の共有フラグが `False` の場合、`共有ボタン` を表示する。
            4. 処理を終了する。
        - 食材は以下の処理で表示を決める。
            1. `＠料理リスト` の食材リストの要素数分食材を表示する。
                - `＠料理リスト` の食材リストの要素数が5件を超える場合は上から5件のみ表示する。
                - 表示は ***⑩食材チェックボックス*** 、`＠料理リスト` の食材リストの食材名、`＠料理リスト` の食材リストの単位数、`＠料理リスト` の食材リストの単位とする。
    7. 画面に更新を行う。


